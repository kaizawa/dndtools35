--alter table MONSTER_SUB_TYPE drop constraint MNSTRSUBTYPEMNSTER;
--alter table MONSTER_SUB_TYPE drop constraint SQL120204101156090;
--alter table MONSTER_MASTER drop constraint SQL120204101156050;
--alter table MONSTER_MASTER drop constraint MNSTERMASTERSIZEID;
--alter table MONSTER_MASTER drop constraint MNSTRMSTERHTDCTYPE;

--alter table encounter_record drop column session;
--alter table "ENCOUNTER_RECORD" add FOREIGN KEY (SCENARIO, CAMPAIGN) REFERENCES SCENARIO_RECORD(ID, CAMPAIGN) ON DELETE CASCADE;

--制約名ゲット
-- SELECT C.CONSTRAINTNAME, T.TABLENAME FROM  SYS.SYSCONSTRAINTS C, SYS.SYSSCHEMAS S, SYS.SYSTABLES T WHERE C.SCHEMAID = S.SCHEMAID AND C.TABLEID = T.TABLEID AND S.SCHEMANAME = 'APP';

-- ARM_MASTER の第二武器の外部キーの追加
--   alter table "ARM_MASTER" add  FOREIGN KEY (SECOND_DAMAGE_TYPE) REFERENCES DAMAGE_TYPE_MASTER(ID) ON DELETE CASCADE 

-- CHARACTER_ARM_RECORD への ATTACK_MODIFIER と DAMAGE_MODIFIER の追加
-- alter table "CHARACTER_ARM_RECORD" add column "ATTACK_MODIFIER" int;
-- alter table "CHARACTER_ARM_RECORD" add column "DAMAGE_MODIFIER" int; 

-- ARM_MASTER への SIZE の追加
-- alter table "ARM_MASTER" add column "SIZE" int
-- alter table "ARM_MASTER" add  FOREIGN KEY (SIZE) REFERENCES SIZE_MASTER(ID)
-- 全て中型にセット
-- update arm_master set size = 5;

-- composite long bow streangth bonus の追加
-- alter table "ARM_MASTER" add column COMPOSITE_LONG_BOW_STRENGTH_BONUS int

-- 高品質追加
alter table "ARM_MASTER" add column MASTERWORK boolean;

DROP TABLE MONSTER_FEAT_RECORD;
DROP TABLE MONSTER_SUB_TYPE_RECORD;
DROP TABLE MONSTER_SKILL_RECORD;
DROP TABLE MONSTER_ABILITY_RECORD;
DROP TABLE MONSTER_SAVE_RECORD;
DROP TABLE MONSTER_MASTER;
DROP TABLE FEAT_MASTER;
DROP TABLE TYPE_MASTER;
DROP TABLE SUB_TYPE_MASTER;
DROP TABLE ENCOUNTER_BATTLE_MEMBER;
DROP TABLE ENCOUNTER_RECORD;
DROP TABLE SCENARIO_CHARACTER_RECORD;
DROP TABLE SCENARIO_RECORD;
-----------


--種別マスター
CREATE TABLE  "TYPE_MASTER"
   (	"ID" INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
	"NAME" VARCHAR(100)
   );

--副種別マスター
CREATE TABLE  "SUB_TYPE_MASTER"
   (	"ID" INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
	"NAME" VARCHAR(100)
   );


--特技マスター
CREATE TABLE  "FEAT_MASTER"
   (	"ID" INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
	"NAME" VARCHAR(100),
        "DESCRIPTION" VARCHAR(4000)
   );

--モンスターマスター
CREATE TABLE "MONSTER_MASTER"
(
  "ID" INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "NAME" VARCHAR(400),
  "SIZE_ID"  INT,
  "TYPE"  INT, --種別
  "HIT_DICE_TYPE" INT,
  "HIT_DICE_NUM" INT, -- ヒットダイス数 
  "INITIATIVE" INT DEFAULT 0,
  "SPEED" INT,
  "AC" INT,
  "AC_TOUCH" INT,
  "AC_FLAT_FOOTED" INT,
  "BASE_ATTACK" INT,
  "GRAPPLE" INT, 
  "ATTACK" VARCHAR(2000),
  "SPACE" INT,
  "REACH" INT,
  "SPECIAL_ATTACKS" VARCHAR(4000),
  "SPECIAL_QUALITIES" VARCHAR(2000),
  "ENVIRONMENT" VARCHAR(2000),
  "ORGANIZATION" VARCHAR(2000),
  "CHALLENGE_RATING" INT, --脅威度
  "TREASURE" VARCHAR(2000), --宝
  "ALIGNMENT" INT,
  "ADVANCEMENT" VARCHAR(2000), --強大化
  "LEVEL_ADJUSTMENT" INT,

   FOREIGN KEY (ALIGNMENT) REFERENCES ALIGNMENT_MASTER(ID),
   FOREIGN KEY (TYPE) REFERENCES TYPE_MASTER(ID),
   FOREIGN KEY (SIZE_ID) REFERENCES SIZE_MASTER(ID),
   FOREIGN KEY (HIT_DICE_TYPE) REFERENCES DICE_MASTER(ID)
);

--モンスター特技レコード
CREATE TABLE "MONSTER_FEAT_RECORD"
  (     "MONSTER" INT,
        "FEAT" INT,
        "FEAT_MODIFIER" INT DEFAULT 0,
        "DESCRIPTION" VARCHAR(4000),

        PRIMARY KEY (MONSTER, FEAT),
        FOREIGN KEY (MONSTER) REFERENCES MONSTER_MASTER(ID) ON DELETE CASCADE,
        FOREIGN KEY (FEAT) REFERENCES FEAT_MASTER(ID)
   );

--モンスター副種別レコード
CREATE TABLE  "MONSTER_SUB_TYPE_RECORD"
   (    "SUB_TYPE" INT,
        "MONSTER" INT,
        "DESCRIPTION" VARCHAR(400),
        PRIMARY KEY (SUB_TYPE, MONSTER),
        FOREIGN KEY (MONSTER) REFERENCES MONSTER_MASTER(ID) ON DELETE CASCADE,
        FOREIGN KEY (SUB_TYPE) REFERENCES SUB_TYPE_MASTER(ID)
   );

--モンスター技能レコード
CREATE TABLE "MONSTER_SKILL_RECORD"
  (     "MONSTER" INT,
        "SKILL" INT,
        "SKILL_MODIFIER" INT DEFAULT 0,
        "DESCRIPTION" VARCHAR(4000),

        PRIMARY KEY (MONSTER, SKILL),
        FOREIGN KEY (MONSTER) REFERENCES MONSTER_MASTER(ID) ON DELETE CASCADE,
        FOREIGN KEY (SKILL) REFERENCES SKILL_MASTER(ID)
   );

--モンスターセーブレコード
CREATE TABLE "MONSTER_SAVE_RECORD"
  (     "MONSTER" INT,
        "SAVE_ID" INT,
        "MISC_MODIFIER" INT,
        "DESCRIPTION" VARCHAR(400),

        PRIMARY KEY (MONSTER, SAVE_ID),
        FOREIGN KEY (MONSTER) REFERENCES MONSTER_MASTER(ID) ON DELETE CASCADE,
        FOREIGN KEY (SAVE_ID) REFERENCES SAVE_MASTER(ID)
   );

--モンスター能力値レコード
CREATE TABLE "MONSTER_ABILITY_RECORD"
  (     "MONSTER" INT,
        "ABILITY_ID" INT,
        "BASE" INT DEFAULT 0,
        "FEAT_MODIFIER" INT DEFAULT 0,
        "MISC_MODIFIER" INT DEFAULT 0,
        "DESCRIPTION" VARCHAR(400),

        PRIMARY KEY (MONSTER, ABILITY_ID),
        FOREIGN KEY (MONSTER) REFERENCES MONSTER_MASTER(ID) ON DELETE CASCADE,
        FOREIGN KEY (ABILITY_ID) REFERENCES ABILITY_MASTER(ID)
   );

--シナリオレコード
CREATE TABLE "SCENARIO_RECORD"
  (
      "ID" INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
      "CAMPAIGN" INT, -- キャンペーン
      "NAME" VARCHAR(400),
      "DESCRIPTION" VARCHAR(8000),

      FOREIGN KEY (CAMPAIGN) REFERENCES CAMPAIGN_MASTER(ID) ON DELETE CASCADE
  ); 


--シナリオキャラクターレコード
CREATE TABLE "SCENARIO_CHARACTER_RECORD"
(
  "ID" INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "SCENARIO" INT, 

  "NAME" VARCHAR(400),
  "KLASS" VARCHAR(200),
  "SIZE_AND_TYPE"  VARCHAR(400), --サイズと種別(副種別)
  "HIT_DICE" VARCHAR(400), -- ヒットダイス 3d6
  "HIT_POINT" INT,
  "INITIATIVE" INT DEFAULT 0,
  "SPEED" INT,
  "ARMOR_CLASS" VARCHAR(400),
  "BASE_ATTACK_GRAPPLE" VARCHAR(400),
  "ATTACK" VARCHAR(2000),
  "FULL_ATTACK" VARCHAR(2000),
  "SPACE_AND_REACH" VARCHAR(200), --接敵面/間合
  "SPECIAL_ATTACKS" VARCHAR(4000),  
  "SPECIAL_QUALITIES" VARCHAR(2000),
  "SAVE" VARCHAR(2000),
  "ABILITIES" VARCHAR(2000),
  "SKILLS" VARCHAR(2000),
  "FEATS" VARCHAR(2000),
  "ENVIRONMENT" VARCHAR(2000),
  "ORGANIZATION" VARCHAR(2000),
  "CHALLENGE_RATING" INT, --脅威度
  "TREASURE" VARCHAR(2000), --宝
  "ALIGNMENT" VARCHAR(200), --属性 真なる中立
  "ADVANCEMENT" VARCHAR(2000), --強大化
  "LEVEL_ADJUSTMENT" INT,
  "IS_PLAYER_CHARACTER" SMALLINT DEFAULT 0,
  "COMMENTS" VARCHAR(4000),

   FOREIGN KEY (SCENARIO) REFERENCES SCENARIO_RECORD(ID) ON DELETE CASCADE
);

--エンカウンターレコード
CREATE TABLE "ENCOUNTER_RECORD" 
   (    "ID" INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
        "SCENARIO_RECORD" INT, 
        "COMMENTS" VARCHAR(4000), 
        "NAME" VARCHAR(255), 
        "ROUND" INTEGER, 
        "TURN" INTEGER, 
        "TURN_CHARACTER" BIGINT, 
        "SCENARIO" INTEGER,

        FOREIGN KEY ("SCENARIO_RECORD") REFERENCES "SCENARIO_RECORD" ("ID") ON DELETE CASCADE
   );

--エンカウンターバトルメンバー
CREATE TABLE "ENCOUNTER_MEMBER" 
   (    "ID" INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
        "ENCOUNTER_RECORD" INT, 
        "INITIATIVE" INTEGER DEFAULT 0, 
        "MY_TURN" SMALLINT DEFAULT 0, 
        "SCENARIO_CHARACTER_RECORD" INT, 
        "COMMENTS" VARCHAR(255),

        FOREIGN KEY ("SCENARIO_CHARACTER_RECORD") REFERENCES "SCENARIO_CHARACTER_RECORD" ("ID") ON DELETE CASCADE,
        FOREIGN KEY ("ENCOUNTER_RECORD") REFERENCES "ENCOUNTER_RECORD" ("ID") ON DELETE CASCADE
   );

//------------

"\#\{bundle.ListTypeMaster(Title_)*(.*)(Link)*}"


ResourceBundle.getBundle\("/Bundle"\)\.getString\("(.*)"\)

//------------

context.addMessage\("(.*) FacesMessage\(\("(.*)"\)\)\);
JsfUtil.addSuccessMessage("$2");

//-------------